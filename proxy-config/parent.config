##############################################################################
# Apache Traffic Server - Parent Configuration
# IDF-Experian - idf_local_proxy
#
# Define quando usar DIRECT (conexão direta) vs PARENT (proxy corporativo)
# Com suporte a FAILOVER entre dois proxies corporativos
##############################################################################

#-----------------------------------------------------------------------------
# REGRA 1: Ranges RFC1918 - Conexão DIRETA
# Redes privadas padrão que devem ser acessadas diretamente
#-----------------------------------------------------------------------------

# 10.0.0.0/8 - Classe A privada
dest_ip=10.0.0.0-10.255.255.255 go_direct=true

# 172.16.0.0/12 - Classe B privada  
dest_ip=172.16.0.0-172.31.255.255 go_direct=true

# 192.168.0.0/16 - Classe C privada
dest_ip=192.168.0.0-192.168.255.255 go_direct=true

#-----------------------------------------------------------------------------
# REGRA 2: Range adicional 198.18.0.0/16 - Conexão DIRETA
# Range utilizado para benchmark/testes (e rede interna específica)
#-----------------------------------------------------------------------------
dest_ip=198.18.0.0-198.19.255.255 go_direct=true

#-----------------------------------------------------------------------------
# REGRA 3: Localhost - Conexão DIRETA
#-----------------------------------------------------------------------------
dest_ip=127.0.0.0-127.255.255.255 go_direct=true

#-----------------------------------------------------------------------------
# REGRA 4: Link-local - Conexão DIRETA
#-----------------------------------------------------------------------------
dest_ip=169.254.0.0-169.254.255.255 go_direct=true

#-----------------------------------------------------------------------------
# REGRA 5: Domínios internos IDF-Experian - Conexão DIRETA
# *.eec, *.eeca, *.eeco e cluster Kubernetes
#-----------------------------------------------------------------------------
dest_domain=.eec go_direct=true
dest_domain=.eeca go_direct=true
dest_domain=.eeco go_direct=true
dest_domain=.svc.cluster.local go_direct=true
dest_domain=.cluster.local go_direct=true

# Localhost por nome
dest_domain=localhost go_direct=true

#-----------------------------------------------------------------------------
# REGRA 6: DEFAULT - Todo o resto vai para o PROXY CORPORATIVO (com failover)
#
# Comportamento com round_robin=strict:
#   - Usa o PRIMEIRO proxy (10.96.215.26:3128) como primário
#   - Se falhar, automaticamente usa o SEGUNDO (10.253.16.93:3128)
#   - Retorna ao primário após retry_time (configurado em records.yaml)
#-----------------------------------------------------------------------------
dest_domain=. parent="10.96.215.26:3128;10.253.16.93:3128" round_robin=strict

##############################################################################
# RESUMO DO ROTEAMENTO:
#
# DIRECT (sem proxy):
#   - 10.0.0.0/8       (RFC1918)
#   - 172.16.0.0/12    (RFC1918)
#   - 192.168.0.0/16   (RFC1918)
#   - 198.18.0.0/16    (Rede interna específica)
#   - 127.0.0.0/8      (Localhost)
#   - 169.254.0.0/16   (Link-local)
#   - *.eec            (Domínio interno IDF-Experian)
#   - *.eeca           (Domínio interno IDF-Experian)
#   - *.eeco           (Domínio interno IDF-Experian)
#   - *.svc.cluster.local (Kubernetes services)
#   - *.cluster.local  (Kubernetes)
#   - localhost
#
# PARENT PROXY (com failover):
#   - Primário:   10.96.215.26:3128
#   - Secundário: 10.253.16.93:3128
#   - Todo o resto (internet) → Primário, fallback para Secundário
#
##############################################################################
